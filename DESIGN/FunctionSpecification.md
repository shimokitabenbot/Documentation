機能仕様書
=========
## 変更履歴
- 2014.01.02 初版
- 2014.01.11 ユーザ認証追加。

## 機能概要
- 下北弁をTwitterにツイートする。

## 機能一覧
機能は以下の通りとする。

- ツイート
- 単語登録
- 単語更新
- 単語検索
- 単語削除
- ヘルスチェック

### ツイート
#### 機能概要
- DBに登録した単語をTwitterにツイートする。
- DBから単語情報を取得し、ツイート文を作成し、ツイートする。

#### HTTPメソッド
POST

#### 入力
- ツイートする文書

#### 出力
- HTTPステータスコード

#### 処理内容
1. 単語テーブルからランダムで単語レコードを1件取得する。
2. 単語レコードから、単語、意味、例文、訳文を取得し、ツイート用文を作成する。
3. ツイート用文をツイートする。

### 単語登録
#### 機能概要
ツイートする単語を登録する。
#### 登録項目
登録項目は、以下の通りとする。

| 項目 | 説明             |
|:----|:-----------|
| 単語 | 登録する単語      |
| 意味 | 単語の意味        |
| 例文 | 単語を使用した例文 |
| 訳文 | 例文の訳文 |

#### 入力

| 項目 | 説明             |
|:----|:-----------|
| 単語 | 登録する単語      |
| 意味 | 単語の意味        |
| 例文 | 単語を使用した例文 |
| 訳文 | 例文の訳文 |


#### 出力
- HTTPステータスコード
- 単語情報 (登録成功時)
- エラー情報 (登録失敗時)

### 単語更新
- (作成中)

### 単語検索
#### 機能概要
登録した単語を検索する。

#### 入力
- キーワード:単語
- 検索オプション: 完全一致(デフォルト)、部分一致のいずれか

#### 出力
- HTTPステータスコード
- 単語テーブルのレコード

#### 処理内容
1. 入力パラメータから単語、検索オプションを取得する。
2. 検索オプションが指定なし、空、完全一致のいずれかの場合、単語を完全一致で単語テーブルから検索する。
3. 検索オプションが部分一致の場合、単語を部分一致で単語テーブルから検索する。
4. 検索結果を返す。

### 単語削除
#### 機能概要
登録した単語を削除する。

#### 入力
- 単語ID

#### 出力
- HTTPステータスコード

#### 処理内容
1. 入力パラメータから単語IDを取得する。
2. 単語IDをキーに単語テーブルからレコードを削除する。

### ヘルスチェック
#### 機能概要
Botの稼働状態をチェックする。
チェックする項目は以下の通り。
- DBアクセス
- Twitterアクセス

#### 入力
なし

#### 出力
- HTTPステータスコード
- ヘルスチェック結果
- DB情報
- Twitter情報

##### DB情報
- 単語登録件数
- 最終単語登録日時

##### Twitter情報
- 最新ツイート文
- 最新ツイート日時

#### 処理内容
1. 単語テーブルから登録単語数を取得する。
2. 単語テーブルから最新単語登録日時を取得する。
3. Twitterにアクセスし、最新ツイート情報を取得する。
4. 1.〜3.で取得した値をチェックする。
5. チェック結果を返す。

##### チェック内容
| チェック項目 | チェック内容  | 判定(OK/NG) |
|:----|:-----------|:-----|
|テーブルアクセス|単語テーブルにアクセスできるか|OK:アクセスできる NG:アクセスできない|
| 単語登録数 | 1件以上登録されているか | OK:登録数が1以上、NG:登録数が1未満 |
| 最新単語登録日時 | 値が空かどうか |OK:値が空でない場合 NG:値が空の場合|
| 最新ツイート情報 | ツイートが取得できるか  |OK:ツイートが取得できる NG:ツイートが取得できない|


## ログ
ログには、処理内容、およびエラーメッセージを出力する。
ログレベル、およびログ出力内容は以下の通りとする。

### ログレベル
| ログレベル | 説明             |
|:----|:-----------|
| info | 主な処理内容を出力する      |
| debug | デバッグログ。入力パラメータや、出力パラメータを出力する。        |
| error | エラーメッセージを出力する。 |

### ログ出力内容
#### 全ログレベル共通
- ログ出力日時

#### info ログ
- コントローラの開始・終了
- 処理成功・失敗

#### debug ログ
- 入力パラメータ (HTTPリクエスト、メソッドパラメータなど)
- 出力パラメータ (HTTPレスポンス、メソッド戻り値など)

## エラー情報
エラー情報には、以下の項目を含む。
- エラーコード
- エラーメッセージ
- エラー詳細

### エラーコード
エラーコードの種類は、以下の通りとする。
- HTTPエラー
- サーバ内部エラー

#### HTTPエラー
先頭2文字は[11]とする。

| エラーコード | 説明             |
|:----|:-----------|
| 11000001 | リクエストボディフォーマット不正 (JSON形式になっていないなど) |
| 11000002 | リクエストヘッダ不正 (Content-Typeがjsonになっていないなど) |
| 11000003 | リクエストパラメータ不正 (文字列の長さが規定値を超過しているなど) |


#### サーバ内部エラー
先頭2文字は、データベースの場合[51]、Twitterの場合[52]とする。

| エラーコード | 説明             |
|:----|:-----------|
| 51000001 | データベースアクセスエラー |
| 51000002 | データベーストランザクションエラー |
| 52000001 | Twitterアクセスエラー |
| 52000002 | Twitter内部エラー |


### エラーメッセージ
エラーメッセージには、エラー固有のメッセージを出力する。

### エラー詳細
エラー詳細には、エラー固有の詳細情報を出力する。  
出力がない場合は、空とする。
